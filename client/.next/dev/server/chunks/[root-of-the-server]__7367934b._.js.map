{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sera%20Shine/Desktop/S62-1025-Nerdvana-Express-Full-Stack-With-NextjsAnd-AWS-Azure-Supply-Chain-Loco-Verify/client/src/lib/logger.ts"],"sourcesContent":["export const logger = {\r\n  info: (message: string, meta?: any) => {\r\n    console.log(JSON.stringify({ \r\n      level: \"info\", \r\n      message, \r\n      meta, \r\n      timestamp: new Date().toISOString() \r\n    }));\r\n  },\r\n  \r\n  error: (message: string, meta?: any) => {\r\n    console.error(JSON.stringify({ \r\n      level: \"error\", \r\n      message, \r\n      meta, \r\n      timestamp: new Date().toISOString() \r\n    }));\r\n  },\r\n  \r\n  warn: (message: string, meta?: any) => {\r\n    console.warn(JSON.stringify({ \r\n      level: \"warn\", \r\n      message, \r\n      meta, \r\n      timestamp: new Date().toISOString() \r\n    }));\r\n  },\r\n  \r\n  debug: (message: string, meta?: any) => {\r\n    console.debug(JSON.stringify({ \r\n      level: \"debug\", \r\n      message, \r\n      meta, \r\n      timestamp: new Date().toISOString() \r\n    }));\r\n  }\r\n};"],"names":[],"mappings":";;;;AAAO,MAAM,SAAS;IACpB,MAAM,CAAC,SAAiB;QACtB,QAAQ,GAAG,CAAC,KAAK,SAAS,CAAC;YACzB,OAAO;YACP;YACA;YACA,WAAW,IAAI,OAAO,WAAW;QACnC;IACF;IAEA,OAAO,CAAC,SAAiB;QACvB,QAAQ,KAAK,CAAC,KAAK,SAAS,CAAC;YAC3B,OAAO;YACP;YACA;YACA,WAAW,IAAI,OAAO,WAAW;QACnC;IACF;IAEA,MAAM,CAAC,SAAiB;QACtB,QAAQ,IAAI,CAAC,KAAK,SAAS,CAAC;YAC1B,OAAO;YACP;YACA;YACA,WAAW,IAAI,OAAO,WAAW;QACnC;IACF;IAEA,OAAO,CAAC,SAAiB;QACvB,QAAQ,KAAK,CAAC,KAAK,SAAS,CAAC;YAC3B,OAAO;YACP;YACA;YACA,WAAW,IAAI,OAAO,WAAW;QACnC;IACF;AACF","debugId":null}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sera%20Shine/Desktop/S62-1025-Nerdvana-Express-Full-Stack-With-NextjsAnd-AWS-Azure-Supply-Chain-Loco-Verify/client/src/lib/errorHandler.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { logger } from \"./logger\";\r\n\r\nexport function handleError(error: any, context: string) {\r\n  const isProd = process.env.NODE_ENV === \"production\";\r\n\r\n  // Determine the appropriate status code\r\n  let statusCode = 500;\r\n  let errorMessage = error.message || \"Unknown error occurred\";\r\n\r\n  // Handle different error types\r\n  if (error.name === 'ValidationError') {\r\n    statusCode = 400;\r\n  } else if (error.name === 'NotFoundError') {\r\n    statusCode = 404;\r\n  } else if (error.name === 'UnauthorizedError') {\r\n    statusCode = 401;\r\n  }\r\n\r\n  // Construct the error response\r\n  const errorResponse: any = {\r\n    success: false,\r\n    message: isProd \r\n      ? getProductionMessage(statusCode)\r\n      : errorMessage,\r\n  };\r\n\r\n  // Include stack trace only in development\r\n  if (!isProd && error.stack) {\r\n    errorResponse.stack = error.stack;\r\n  }\r\n\r\n  // Include additional error details in development\r\n  if (!isProd && error.details) {\r\n    errorResponse.details = error.details;\r\n  }\r\n\r\n  // Log the error with structured data\r\n  logger.error(`Error in ${context}`, {\r\n    message: errorMessage,\r\n    statusCode: statusCode,\r\n    stack: isProd ? \"REDACTED\" : error.stack,\r\n    context: context,\r\n    timestamp: new Date().toISOString()\r\n  });\r\n\r\n  return NextResponse.json(errorResponse, { status: statusCode });\r\n}\r\n\r\n// Helper function to get user-friendly production messages\r\nfunction getProductionMessage(statusCode: number): string {\r\n  const messages: { [key: number]: string } = {\r\n    400: \"Invalid request. Please check your input.\",\r\n    401: \"Authentication required. Please log in.\",\r\n    403: \"You don't have permission to access this resource.\",\r\n    404: \"The requested resource was not found.\",\r\n    500: \"Something went wrong. Please try again later.\",\r\n    503: \"Service temporarily unavailable. Please try again later.\"\r\n  };\r\n\r\n  return messages[statusCode] || \"Something went wrong. Please try again later.\";\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,YAAY,KAAU,EAAE,OAAe;IACrD,MAAM,SAAS,oDAAyB;IAExC,wCAAwC;IACxC,IAAI,aAAa;IACjB,IAAI,eAAe,MAAM,OAAO,IAAI;IAEpC,+BAA+B;IAC/B,IAAI,MAAM,IAAI,KAAK,mBAAmB;QACpC,aAAa;IACf,OAAO,IAAI,MAAM,IAAI,KAAK,iBAAiB;QACzC,aAAa;IACf,OAAO,IAAI,MAAM,IAAI,KAAK,qBAAqB;QAC7C,aAAa;IACf;IAEA,+BAA+B;IAC/B,MAAM,gBAAqB;QACzB,SAAS;QACT,SAAS,sCACL,0BACA;IACN;IAEA,0CAA0C;IAC1C,IAAI,CAAC,UAAU,MAAM,KAAK,EAAE;QAC1B,cAAc,KAAK,GAAG,MAAM,KAAK;IACnC;IAEA,kDAAkD;IAClD,IAAI,CAAC,UAAU,MAAM,OAAO,EAAE;QAC5B,cAAc,OAAO,GAAG,MAAM,OAAO;IACvC;IAEA,qCAAqC;IACrC,sRAAM,CAAC,KAAK,CAAC,CAAC,SAAS,EAAE,SAAS,EAAE;QAClC,SAAS;QACT,YAAY;QACZ,OAAO,sCAAS,0BAAa,MAAM,KAAK;QACxC,SAAS;QACT,WAAW,IAAI,OAAO,WAAW;IACnC;IAEA,OAAO,sSAAY,CAAC,IAAI,CAAC,eAAe;QAAE,QAAQ;IAAW;AAC/D;AAEA,2DAA2D;AAC3D,SAAS,qBAAqB,UAAkB;IAC9C,MAAM,WAAsC;QAC1C,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;IACP;IAEA,OAAO,QAAQ,CAAC,WAAW,IAAI;AACjC","debugId":null}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sera%20Shine/Desktop/S62-1025-Nerdvana-Express-Full-Stack-With-NextjsAnd-AWS-Azure-Supply-Chain-Loco-Verify/client/src/app/api/users/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { PrismaClient, Role } from \"@prisma/client\";\r\nimport { handleError } from \"../../../lib/errorHandler\"; // Add this import\r\n\r\nconst prisma = new PrismaClient();\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"supersecretkey\";\r\n\r\n// âœ… GET route â€” Verify token, fetch user, and authorize by role\r\nexport async function GET(request: Request) {\r\n  try {\r\n    const authHeader = request.headers.get(\"authorization\");\r\n\r\n    if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n      // Convert this to use error throwing for consistent handling\r\n      const error = new Error(\"Authorization token missing or invalid format\");\r\n      error.name = \"ValidationError\";\r\n      throw error;\r\n    }\r\n\r\n    const token = authHeader.split(\" \")[1];\r\n    \r\n    let decoded;\r\n    try {\r\n      decoded = jwt.verify(token, JWT_SECRET) as {\r\n        id: number;\r\n        email: string;\r\n        role: string;\r\n      };\r\n    } catch (jwtError) {\r\n      const error = new Error(\"Invalid or expired token\");\r\n      error.name = \"UnauthorizedError\";\r\n      throw error;\r\n    }\r\n\r\n    // ðŸ§© Fetch user from database\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: decoded.id.toString() },\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        email: true,\r\n        role: true,\r\n        createdAt: true,\r\n      },\r\n    });\r\n\r\n    if (!user) {\r\n      const error = new Error(\"User not found\");\r\n      error.name = \"NotFoundError\";\r\n      throw error;\r\n    }\r\n\r\n    // ðŸ§  Role-based access example\r\n    if (user.role !== Role.VENDOR && user.role !== Role.ADMIN) {\r\n      const error = new Error(\"Access denied. Invalid role.\");\r\n      error.name = \"UnauthorizedError\";\r\n      throw error;\r\n    }\r\n\r\n    // âœ… Success â€” send user info\r\n    return NextResponse.json(\r\n      {\r\n        success: true,\r\n        message: `Access granted. Hello ${user.role === \"ADMIN\" ? \"ADMIN\" : \"VENDOR\"}!`,\r\n        user,\r\n      },\r\n      { status: 200 }\r\n    );\r\n  } catch (error) {\r\n    // Use the centralized error handler instead of manual error responses\r\n    return handleError(error, \"GET /api/users\");\r\n  } finally {\r\n    await prisma.$disconnect();\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA,sdAAyD,kBAAkB;;;;;AAE3E,MAAM,SAAS,IAAI,6IAAY;AAC/B,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAGtC,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QAEvC,IAAI,CAAC,cAAc,CAAC,WAAW,UAAU,CAAC,YAAY;YACpD,6DAA6D;YAC7D,MAAM,QAAQ,IAAI,MAAM;YACxB,MAAM,IAAI,GAAG;YACb,MAAM;QACR;QAEA,MAAM,QAAQ,WAAW,KAAK,CAAC,IAAI,CAAC,EAAE;QAEtC,IAAI;QACJ,IAAI;YACF,UAAU,wSAAG,CAAC,MAAM,CAAC,OAAO;QAK9B,EAAE,OAAO,UAAU;YACjB,MAAM,QAAQ,IAAI,MAAM;YACxB,MAAM,IAAI,GAAG;YACb,MAAM;QACR;QAEA,8BAA8B;QAC9B,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE,IAAI,QAAQ,EAAE,CAAC,QAAQ;YAAG;YACnC,QAAQ;gBACN,IAAI;gBACJ,MAAM;gBACN,OAAO;gBACP,MAAM;gBACN,WAAW;YACb;QACF;QAEA,IAAI,CAAC,MAAM;YACT,MAAM,QAAQ,IAAI,MAAM;YACxB,MAAM,IAAI,GAAG;YACb,MAAM;QACR;QAEA,+BAA+B;QAC/B,IAAI,KAAK,IAAI,KAAK,qIAAI,CAAC,MAAM,IAAI,KAAK,IAAI,KAAK,qIAAI,CAAC,KAAK,EAAE;YACzD,MAAM,QAAQ,IAAI,MAAM;YACxB,MAAM,IAAI,GAAG;YACb,MAAM;QACR;QAEA,6BAA6B;QAC7B,OAAO,sSAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,SAAS,CAAC,sBAAsB,EAAE,KAAK,IAAI,KAAK,UAAU,UAAU,SAAS,CAAC,CAAC;YAC/E;QACF,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,sEAAsE;QACtE,OAAO,IAAA,iSAAW,EAAC,OAAO;IAC5B,SAAU;QACR,MAAM,OAAO,WAAW;IAC1B;AACF","debugId":null}}]
}